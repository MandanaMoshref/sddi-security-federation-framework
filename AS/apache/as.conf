<VirtualHost *:80>
    ServerName as.sddi.secure-dimensions.de:80

    ServerSignature Off

    RewriteEngine On
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,QSA,R=permanent]

    ErrorLog /var/log/httpd/redirect.error.log
    LogLevel warn
</VirtualHost>

<VirtualHost *:443>
        ServerName as.sddi.secure-dimensions.de:443
        DocumentRoot /opt/authorization-server/www

        LogLevel warn rewrite:warn ssl:warn
        ErrorLog /var/log/httpd/as.sddi.error.log

        UseCanonicalName On

        SSLEngine on
        SSLProtocol all -SSLv2 -SSLv3 -TLSv1.1
        SSLCipherSuite ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:DHE-DSS-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA256:ADH-AES256-GCM-SHA384:ADH-AES256-SHA256:ECDH-RSA-AES256-GCM-SHA384:ECDH-ECDSA-AES256-GCM-SHA384:ECDH-RSA-AES256-SHA384:ECDH-ECDSA-AES256-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:DHE-DSS-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:DHE-DSS-AES128-SHA256:ADH-AES128-GCM-SHA256:ADH-AES128-SHA256:ECDH-RSA-AES128-GCM-SHA256:ECDH-ECDSA-AES128-GCM-SHA256:ECDH-RSA-AES128-SHA256:ECDH-ECDSA-AES128-SHA256
        SSLHonorCipherOrder on
        SSLCertificateFile /etc/pki/tls/certs/sddi.secure-dimensions.de.crt
        SSLCertificateKeyFile /etc/pki/tls/private/sddi.secure-dimensions.de.pem
        SSLCertificateChainFile /etc/pki/tls/certs/sddi_secure-dimensions_de.ca-bundle

        php_value memory_limit 512M

    <Directory "/opt/authorization-server/www/">
        AllowOverride All
        Require all granted
        DirectoryIndex index.php
    </Directory>

    <Location /api>
        Require all granted
	Directoryindex index.html
    </Location>

    RewriteEngine on

    RewriteCond "%{REQUEST_URI}"  "^/oauth"  [OR]
    RewriteCond "%{REQUEST_URI}"  "^/openid"  [OR]
    RewriteCond "%{REQUEST_URI}"  "^/saml" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/listapps" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/registerapps" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/authorizedapps" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/logoutapps" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/logoutcomplete" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/listapp" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/listapps" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/listoperators" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/.well-known" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/NoPrivacyStatement" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/PrivacyStatement" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/CookieStatement" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/TermsOfUse" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/IdPs" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/Operators" [OR]
    RewriteCond "%{REQUEST_URI}"  "^/DiscoveryService"
    RewriteRule (.*) /as.php/$1 [qsappend,L]

    SetEnv SIMPLESAMLPHP_CONFIG_DIR /opt/authorization-server/vendor/simplesamlphp/simplesamlphp/config

    Alias /simplesaml /opt/authorization-server/vendor/simplesamlphp/simplesamlphp/www

    RedirectPermanent /3dclient https://www.3dcitydb.org/qeop-web-map-security/3dwebclient/index.html?title=3DCityDB-Web-Map-Client&shadows=false&terrainShadows=0&latitude=51.54598057331442&longitude=-0.012735535769912739&height=138.82756086880357&heading=356.0176491942962&pitch=-53.16764902308586&roll=359.9781813714569&layer_0=url%3Dhttps%253A%252F%252Fwww.3dcitydb.net%252F3dcitydb%252Ffileadmin%252Fmydata%252FLondon_QEOP_Demo%252FQEOP_Buildings_v3%252FQEOP_Buildings_LoD2_collada_MasterJSON.json%26name%3DQEOP_Buildings_LoD2%26active%3Dtrue%26spreadsheetUrl%3Dhttps%253A%252F%252Fwfs.sddi.secure-dimensions.de%252Fcitydb-wfs-qeop%252Fwfs%253FSERVICE%253DWFS%2526VERSION%253D2.0.0%2526REQUEST%253DGetFeature%26cityobjectsJsonUrl%3Dhttps%253A%252F%252Fwww.3dcitydb.net%252F3dcitydb%252Ffileadmin%252Fmydata%252FLondon_QEOP_Demo%252FQEOP_Buildings_v3%252FQEOP_Buildings_LoD2.json%26minLodPixels%3D50%26maxLodPixels%3D1.7976931348623157e%252B308%26maxSizeOfCachedTiles%3D200%26maxCountOfVisibleTiles%3D200&layer_1=url%3Dhttps%253A%252F%252Fwww.3dcitydb.net%252F3dcitydb%252Ffileadmin%252Fmydata%252FLondon_QEOP_Demo%252FQEOP_Roads_v2%252FQEOP_Road_Footprints_footprint_MasterJSON.json%26name%3DQEOP_Streets%26active%3Dfalse%26spreadsheetUrl%3Dhttps%253A%252F%252Fwww.google.com%252Ffusiontables%252FDataSource%253Fdocid%253D1iwLlUEZkgMfSonGYaXV0QuZgGzNex8DzOlbvxTfd%26cityobjectsJsonUrl%3Dhttps%253A%252F%252Fwww.3dcitydb.net%252F3dcitydb%252Ffileadmin%252Fmydata%252FLondon_QEOP_Demo%252FQEOP_Roads_v2%252FQEOP_Road_Footprints.json%26minLodPixels%3D50%26maxLodPixels%3D1.7976931348623157e%252B308%26maxSizeOfCachedTiles%3D200%26maxCountOfVisibleTiles%3D200

    <Directory /opt/authorization-server/vendor/simplesamlphp/simplesamlphp/www>
        Require all granted
    </Directory>

</VirtualHost>
